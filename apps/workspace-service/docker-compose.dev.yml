version: "3.8"

services:
  agent-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "3001:3001"
    volumes:
      # Mount agent source for live editing
      - ./src:/app/src:ro
      # Mount a test project directory
      - ${TEST_PROJECT_DIR:-./test-project}:/home/coder/workspace/project
      # Persist agent history (sibling to project, not inside it)
      - agent-data:/home/coder/workspace/.aether
    environment:
      - AGENT_PORT=3001
      - PROJECT_CWD=/home/coder/workspace/project
      - STORAGE_DIR=/home/coder/workspace/.aether
      - LOCAL_MODE=true
      # API keys from host .env
      - ANTHROPIC_API_KEY
      - OPENAI_API_KEY
      - CODEBUFF_API_KEY
      - CODEBUFF_BYOK_OPENROUTER
      - OPENROUTER_API_KEY
    working_dir: /app
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  agent-data:
